<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>recherche</title>
    <link href="../css/style.css" rel="stylesheet">
    <link href="../css/Style-Accueil.css" rel="stylesheet">
    <link href="../css/divider.css" rel="stylesheet">
    <script crossorigin="anonymous" src="https://kit.fontawesome.com/86aa9796b2.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
    <link rel="icon" type="image/png" href="../img/logo_white.png" style="color: white">
    <script src="../js/fonction.js"></script>
    <script>
        $(document).ready(function () {
            let url = new URL(window.location.href);
            let cat = url.searchParams.get("cat")
            let recherche = url.searchParams.get("recherche")
            if (cat) {
                $.ajax({
                    url: "../bd.php",
                    type: "POST",
                    dataType: "json",
                    data: {
                        "requete": "getVenteCat",
                        "cat": cat
                    },
                    success: function (reponse) {
                        let url = new URL(window.location.href);
                        let user = url.searchParams.get("user")

                        reponse.forEach(function (item) {
                            if (user) {
                                $.ajax({
                                    url: "../bd.php",
                                    type: "POST",
                                    dataType: "json",
                                    data: {
                                        "requete": "verifSuivie",
                                        "user": user,
                                        "vente_id": item['id']
                                    },
                                    success: function (rep) {

                                        console.log(item['Path'])
                                        ajout(item['id'], item['titre'], item['date'], '../image/' + item['Path'], rep)
                                    }
                                    ,
                                    error: function (rep) {
                                    }
                                });
                            } else {
                                ajout(item['id'], item['titre'], item['date'], '../image/' + item['Path'], false)
                            }


                        })


                    },
                    error: function (message, e) {

                    }
                });
            } else {
                $('#recherche_header').text("Resultat de recherche : " + recherche)
                $.ajax({
                    url: "../bd.php",
                    type: "POST",
                    dataType: "json",
                    data: {
                        "requete": "getVenteRecherche",
                        "recherche": recherche
                    },
                    success: function (reponse) {
                        let url = new URL(window.location.href);
                        let user = url.searchParams.get("user")
                        reponse.forEach(function (item) {
                            if (user) {
                                $.ajax({
                                    url: "../bd.php",
                                    type: "POST",
                                    dataType: "json",
                                    data: {
                                        "requete": "verifSuivie",
                                        "user": user,
                                        "vente_id": item['id']
                                    },
                                    success: function (rep) {

                                        console.log(item['Path'])
                                        ajout(item['id'], item['titre'], item['date'], '../image/' + item['Path'], rep)
                                    }
                                    ,
                                    error: function (rep) {
                                    }
                                });
                            } else {
                                ajout(item['id'], item['titre'], item['date'], '../image/' + item['Path'], false)
                            }


                        })
                    }
                    ,
                    error: function (message, e) {

                    }
                });
            }


        })
        ;
    </script>
</head>

<!--Body du site-->
<body style="background-color:#f8f9f9">

<!--Partie principale du site-->
<header>

    <div class="logo_container">
        <img src="Ressources-Supplementaires/logo.png">
    </div>
    <p>Recherche</p>
    <div class="searchbar">
        <input class="search_text" name="search_text" placeholder="Recherche..." type="text"/>
        <button class="btSearch" onclick="chan"><i class="fas fa-search"></i></button>
    </div>
    <div class="header-user">

        <a id="login-btn" class="login" href="login.html">Se connecter</a>
        <a id="user-btn" class="user-btn" href="signin.html">Cr√©er un compte</a>

    </div>
    </div>


</header>

<h1 id="recherche_header" style="text-align:center;"> Recherche</h1>

<div id="liste_suivi" class="liste_ventes">
</div>
<script>
    function ajout(id, titre, date, photo, suivie) {
        if (suivie) {
            let template =
                " <div class=\"card\"onclick='afficherSuivie(" + id + ")'>\n" +
                "        <div class=\"div_photo\">\n" +
                "        <img src=" + photo + ">\n" +
                "        </div>\n" +
                "        <div class=\"container\">\n" +
                "            <h4 class=\"Titre\">" + titre + "</h4>\n" +
                "            <p class=\"date\">" + date + "</p>\n" +
                "        <div class=\"div_bouton_vente\">\n" +
                "               <p class=\"suivie\" >" + 'suivie' + "</p>\n" +
                "        </div>\n" +
                "        </div>\n" +
                "    </div>"
            $("#liste_suivi").append(template);
        } else {
            let template =
                " <div class=\"card\"onclick='afficherSuivie(" + id + ")'>\n" +
                "        <div class=\"div_photo\">\n" +
                "        <img src=" + photo + ">\n" +
                "        </div>\n" +
                "        <div class=\"container\">\n" +
                "            <h4 class=\"Titre\">" + titre + "</h4>\n" +
                "            <p class=\"date\">" + date + "</p>\n" +
                "        <div class=\"div_bouton_vente\">\n" +
                "              <p class=\"suivie\" >" + 'Non-suivie' + "</p>\n" +
                "        </div>\n" +
                "        </div>\n" +
                "    </div>"
            $("#liste_suivi").append(template);
        }
    }
</script>
</body>